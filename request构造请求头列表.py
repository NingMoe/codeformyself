import re

import requests
from faker import Faker
from requests.adapters import HTTPAdapter

f = Faker(locale='zh_CN')

test_url = 'http://guangzhou.11467.com/luogangqu/s752/'


def get_proxy():
	url = 'http://192.168.107.38:5555/shunqiwang/random'
	response = requests.get(url)
	proxy = response.text
	return proxy


no_proxy = set()
for k in range(1, 100):
	
	headers = {
		'User-Agent': f.chrome()}
	proxies = {"http": "http://" + get_proxy()}
	
	try:
		s = requests.Session()
		s.mount('http://', HTTPAdapter(max_retries=3))
		response = s.get(test_url, headers=headers, proxies=proxies, timeout=1)
		if response.status_code == 404:
			print(response.text)
	except Exception as e:
		
		print(k, e)
		e = str(e)
		ll = re.findall("(host='.*', port=\d+)", e)
		for i in ll:
			d = i.split('=')
			print(d)
			lc = d[1]
			proxy = lc.split(',')[0].strip("'") + ":" + d[-1]
			
			urls = 'http://192.168.107.38:5555/shunqiwang/' + proxy + '/del'
			response = requests.get(urls)
			no_proxy.add(proxy)

print(no_proxy)

# tar = {'60.13.50.201:3012', '58.208.235.32:2589', '116.149.202.64:6436', '114.236.62.98:3456', '220.189.86.142:2549',
#        '114.99.5.111:4276', '117.94.119.55:4734', '220.189.86.247:2549', '116.149.202.231:6436', '223.153.180.21:4283',
#        '115.224.64.46:2314', '60.161.153.152:4271', '171.125.161.154:6996', '61.131.227.28:5632', '112.122.220.34:4224',
#        '111.76.157.79:5324', '1.85.72.195:4275', '175.153.71.203:7684', '112.113.152.154:4242', '118.252.67.252:7524',
#        '36.32.44.235:6436', '114.234.213.70:4243', '223.242.128.198:4251', '182.113.57.228:4242',
#        '125.111.147.108:4205', '36.34.14.86:6436', '119.7.82.167:4255', '124.152.85.77:3012', '222.220.37.127:2136',
#        '114.217.97.131:2589', '59.63.40.131:5632', '106.56.205.237:4230', '60.188.39.96:7586', '113.223.100.28:7524',
#        '171.125.227.23:6996', '36.34.12.135:6436', '112.122.220.151:4286', '114.235.201.108:4243',
#        '183.147.181.86:4230', '106.110.203.177:1649', '119.177.55.55:1245', '117.27.27.155:4275', '60.219.217.237:1648',
#        '119.5.181.166:3979', '42.239.251.156:4242', '60.161.152.182:4232', '114.236.62.51:3456', '123.121.139.166:4256',
#        '115.85.206.213:3012', '59.62.6.175:4261', '218.8.132.90:6410', '112.117.47.137:4278', '112.84.98.188:4278',
#        '182.101.241.40:4256', '42.177.226.211:2589', '116.149.192.183:6436', '113.120.62.100:4242',
#        '123.188.117.211:3738', '112.83.2.61:2589', '175.42.158.187:4254', '60.160.186.239:4265'}

# url = 'http://192.168.107.38:5555/shunqiwang/'
# for i in tar:
# 	urls = url + i + '/del'
# 	response = requests.get(urls)
