from urllib.parse import urlencode

from Crypto.Signature import PKCS1_v1_5
from Crypto.Hash import SHA256
from Crypto.PublicKey import RSA
import base64

private_key = '''-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA4VoHujAt31BlzIbCyNXDYEVt5F03WMEdkQ+i0RPu0YzrLUP0VGZL7R/gY3ZqDrzUau4+nDjIZ3qOyUxX2SUiL4XNgoR/0ux9KUnl8HjNmPMfFStYfDttSQYm1LwFxRaET8o+X7fM4u5UhfzR9FXJZJ8l0AIPvVAp7qgjQ0NBoLWMNFDVPJkrChw7fPuogw8lroWflBEpP6+QqTRD58+tj9C17h2cFXMpuV2aRBXsNLIg6TzoQg/fgA0nth8k25Z/npv7HMO29oOJ2tbpZltXY/2WLI407Cf8UG1dKP68M986OkwwjtPpv6jEHVoZizE/+zj4qTy7uu78lsaqppb32wIDAQABAoIBAQCzdf4XYUz2vVEEiwFN7SY1YbU9Gpr7/HauUhRoioYyrRWQq8BFAl5OzYblzqRxbiF/spF72aCG/8v8NOb0z6Sk0dqyqRAeiiS2n9oVIi8hMeQ7+JP0A2NptxNvcPjrVp4x6K65jWcGBaScO5V8DmFe13rGZw3fxppOK+pBI6t87fifUuiNNzdgqUOIXAx4kypYBAzCPuVH2ypxMxYnhnIrZ9iZcayYbF2mrYax4YGwMckGs4uFzOPiJHj6vg4cEL4g3b1vOrDgY1wwnmTM93HNqS89WYVOpFDnOTRsOlmL6COJH2U/YqHe3CbYxGXJnYjLqKJ/k5QwXaZoK+98wUnJAoGBAPhaqIh++o93gF7vicsboHT0l5DvqCPSwdwFBlr2i3ODuVLrUvHbrRDN0bTlWwO2GuEBZyXGqNGerMaJlr67BTXIg4KDwXCpMJ8YxyRUQ7EGsLp3WS6Zzt6VeSKYRMzu7CHfyUzXwK0e5kylVWeiclzFEBWHpGC5FsYRoSYNSU6/AoGBAOhKFW2b4PhjCBDzQZrUWd0lR7aGufyHaKUEVKS5isXXmOonWQT4BEsLcXX1m9i3ZN0gB4uCY+bdiLkdoEwPppSRG0e7z0a0MRB6YtC5LBhkUcYKIS41dYsOeNG2cAG2Cs3UZwHgnyC9g1NFFoCkhkV1fyRWi32c2GQCsJzIRTnlAoGADIVFidwc9a6ooiChacPyyvKp0XzDlUrCyzzVnTBgx2oUpcGHZPoWN4qoz93gQMelg0J22MizKh49x6SYHPWAxb1eI+5QikV9VggBwisdXodf0YbC0D6g10fh24Shs1M4RFzr4Rvfctrj8WlEbP0bluG4dd1oxBeQtludLDXvRDECgYAdHuyAyUHy4bdpKJXY6zY42yuaXlmCpxcfWOOjov8avmSVNkmard0b61tWBmx7RsKGVjWb78TGdI9nZadq4atohKh+3bSmkIB2KGGq+QvmIu19fleai2ko/a932v8/t6qzEyW2voo0eI22KrsfdYC/xHMkAxWJsdgO8adigFjtYQKBgGlEJcXfOKNICdKsN0/v5LSop8ZC20mO1bBHNZu8vk37/6peAH1geICS6BKfooNChavn6dfBi+ch2W19Jq73/nuYj1wdvVzkpXBmjnTLig7XBa4iOs1z/we1l+oBXf/zjg8wbptx/02mBuay6Zt3k9Pk8NjmlmqMeYje4Y+mbcg9
-----END RSA PRIVATE KEY-----'''


# private_key = '''MIIEowIBAAKCAQEA4VoHujAt31BlzIbCyNXDYEVt5F03WMEdkQ+i0RPu0YzrLUP0VGZL7R/gY3ZqDrzUau4+nDjIZ3qOyUxX2SUiL4XNgoR/0ux9KUnl8HjNmPMfFStYfDttSQYm1LwFxRaET8o+X7fM4u5UhfzR9FXJZJ8l0AIPvVAp7qgjQ0NBoLWMNFDVPJkrChw7fPuogw8lroWflBEpP6+QqTRD58+tj9C17h2cFXMpuV2aRBXsNLIg6TzoQg/fgA0nth8k25Z/npv7HMO29oOJ2tbpZltXY/2WLI407Cf8UG1dKP68M986OkwwjtPpv6jEHVoZizE/+zj4qTy7uu78lsaqppb32wIDAQABAoIBAQCzdf4XYUz2vVEEiwFN7SY1YbU9Gpr7/HauUhRoioYyrRWQq8BFAl5OzYblzqRxbiF/spF72aCG/8v8NOb0z6Sk0dqyqRAeiiS2n9oVIi8hMeQ7+JP0A2NptxNvcPjrVp4x6K65jWcGBaScO5V8DmFe13rGZw3fxppOK+pBI6t87fifUuiNNzdgqUOIXAx4kypYBAzCPuVH2ypxMxYnhnIrZ9iZcayYbF2mrYax4YGwMckGs4uFzOPiJHj6vg4cEL4g3b1vOrDgY1wwnmTM93HNqS89WYVOpFDnOTRsOlmL6COJH2U/YqHe3CbYxGXJnYjLqKJ/k5QwXaZoK+98wUnJAoGBAPhaqIh++o93gF7vicsboHT0l5DvqCPSwdwFBlr2i3ODuVLrUvHbrRDN0bTlWwO2GuEBZyXGqNGerMaJlr67BTXIg4KDwXCpMJ8YxyRUQ7EGsLp3WS6Zzt6VeSKYRMzu7CHfyUzXwK0e5kylVWeiclzFEBWHpGC5FsYRoSYNSU6/AoGBAOhKFW2b4PhjCBDzQZrUWd0lR7aGufyHaKUEVKS5isXXmOonWQT4BEsLcXX1m9i3ZN0gB4uCY+bdiLkdoEwPppSRG0e7z0a0MRB6YtC5LBhkUcYKIS41dYsOeNG2cAG2Cs3UZwHgnyC9g1NFFoCkhkV1fyRWi32c2GQCsJzIRTnlAoGADIVFidwc9a6ooiChacPyyvKp0XzDlUrCyzzVnTBgx2oUpcGHZPoWN4qoz93gQMelg0J22MizKh49x6SYHPWAxb1eI+5QikV9VggBwisdXodf0YbC0D6g10fh24Shs1M4RFzr4Rvfctrj8WlEbP0bluG4dd1oxBeQtludLDXvRDECgYAdHuyAyUHy4bdpKJXY6zY42yuaXlmCpxcfWOOjov8avmSVNkmard0b61tWBmx7RsKGVjWb78TGdI9nZadq4atohKh+3bSmkIB2KGGq+QvmIu19fleai2ko/a932v8/t6qzEyW2voo0eI22KrsfdYC/xHMkAxWJsdgO8adigFjtYQKBgGlEJcXfOKNICdKsN0/v5LSop8ZC20mO1bBHNZu8vk37/6peAH1geICS6BKfooNChavn6dfBi+ch2W19Jq73/nuYj1wdvVzkpXBmjnTLig7XBa4iOs1z/we1l+oBXf/zjg8wbptx/02mBuay6Zt3k9Pk8NjmlmqMeYje4Y+mbcg9'''


def sign_string(unsigned_string):
    key = RSA.importKey(private_key)
    signer = PKCS1_v1_5.new(key)
    signature = signer.sign(SHA256.new(unsigned_string.encode("utf8")))
    sign = base64.encodebytes(signature).decode("utf8").replace("", "")
    print(sign)
    from urllib import parse
    new_url = parse.quote_plus(sign)
    print(new_url)
    return sign


if __name__ == '__main__':

    unsigned_string = 'appid=859977c6f22b4f9ce98d4b02d031b4a8&lang=zh-cn&store_id=25023' #这是正确代码
    # unsigned_string = 'appid=859977c6f22b4f9ce98d4b02d031b4a8&lang=zh_CN&{"in_business":1,"latitude":"39.907098","longitude":"116.429323"}'
    sign_string(unsigned_string)

"""mcOSiT9YT7246yLUxPIa9bPvHtjWVJn/mp90Kdk3H/9BG72vriVEHmfQBnXrSaRs1Wpm++ct9hIY
nX7X+mTSi+uLJNtcl331d7pWrl+u6R42lZ9Agl3ISCPes0RqEyyWGyGpI2KSeK1EKK7eLOgelxMb
/lYRhZqVkj2BVV5foHtAwAI5m0Pls8+ShPuI0mTQPbQqW3S2j/ii68VmpIXddCU6yAw02sZG7+rE
lJHL5EvG5ybdC881LO1i0YPIWhkW6tUL4G/B7y3pzEkICRX5ium4HHMaoIYjz4PjTJtW6qM0gYZG
qr6djRfRts/8d5pEZsrnOryskKOpd/3XW0lSfA=="""
